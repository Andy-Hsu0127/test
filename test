<!-- templates/customer/customer_list.html -->
{% extends "home.html" %}

{% block content %}
<div class="container mt-5">
  <a href="{% url 'customer_create' %}" class="btn btn-primary btn-sm d-flex align-items-center" title="新增客戶">
    <i class="bi bi-plus-square me-2"></i> 新增客戶
  </a>
  <div class="card shadow-lg">
    
    <div class="card-body">
      
      <!-- 搜尋表單 -->
      <form method="get" class="row g-3 mb-4">
        <div class="col-md-10">
          <div class="input-group">
            <span class="input-group-text" id="search"><i class="bi bi-search"></i></span>
            <input type="text" name="search" class="form-control" placeholder="搜尋客戶名稱或代碼" aria-label="搜尋客戶名稱或代碼" aria-describedby="search" value="{{ request.GET.search }}">
          </div>
        </div>
        <div class="col-md-2 d-flex">
            <button type="submit" class="btn btn-primary me-2 btn-sm">
              <i class="bi bi-search"></i> 搜尋
            </button>
          </div>
      </form>

      <!-- 表格 -->
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th scope="col">客戶 <i class="bi bi-sort"></i></th>
              <th scope="col">代碼 <i class="bi bi-sort"></i></th>
              <th scope="col">統一編號 <i class="bi bi-sort"></i></th>
              <th scope="col">聯絡人 <i class="bi bi-sort"></i></th>
              <th scope="col">電話 <i class="bi bi-sort"></i></th>
              <th scope="col">Email <i class="bi bi-sort"></i></th>
              <th scope="col">操作</th>
            </tr>
          </thead>
          <tbody>
            {% for customer in customers %}
            <tr>
              <td>{{ customer.customer_name }}</td>
              <td>{{ customer.customer_code }}</td>
              <td>{{ customer.unified_number }}</td>
              <td>{{ customer.contact_person }}</td>
              <td>{{ customer.contact_phone }}</td>
              <td>{{ customer.email }}</td>
              <td>
                <div class="btn-group" role="group" aria-label="操作按鈕群組">
                  <a href="{% url 'customer_update' customer.pk %}" class="btn btn-info btn-sm" title="編輯">
                    <i class="bi bi-pencil-square"></i>
                  </a>
                  <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ customer.pk }}" title="刪除">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>

                <!-- 刪除確認模態框 -->
                <div class="modal fade" id="deleteModal{{ customer.pk }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ customer.pk }}" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="deleteModalLabel{{ customer.pk }}">確認刪除</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="關閉"></button>
                      </div>
                      <div class="modal-body">
                        您確定要刪除客戶 <strong>{{ customer.customer_name }}</strong> 嗎？
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <a href="{% url 'customer_delete' customer.pk %}" class="btn btn-danger">刪除</a>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center">沒有客戶資料。</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- 分頁 -->
      {% if is_paginated %}
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
          <!-- 上一頁 -->
          {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ page_obj.previous_page_number }}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
              <span class="visually-hidden">上一頁</span>
            </a>
          </li>
          {% else %}
          <li class="page-item disabled">
            <span class="page-link" aria-hidden="true">&laquo;</span>
            <span class="visually-hidden">上一頁</span>
          </li>
          {% endif %}

          <!-- 頁碼 -->
          {% for num in paginator.page_range %}
            {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
              {% if page_obj.number == num %}
                <li class="page-item active" aria-current="page">
                  <span class="page-link">{{ num }} <span class="visually-hidden">(current)</span></span>
                </li>
              {% else %}
                <li class="page-item"><a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% elif num == 1 or num == paginator.num_pages %}
              {% if page_obj.number == num %}
                <li class="page-item active" aria-current="page">
                  <span class="page-link">{{ num }} <span class="visually-hidden">(current)</span></span>
                </li>
              {% else %}
                <li class="page-item"><a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% elif num == page_obj.number|add:'-3' or num == page_obj.number|add:'3' %}
              <li class="page-item disabled"><span class="page-link">…</span></li>
            {% endif %}
          {% endfor %}

          <!-- 下一頁 -->
          {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}page={{ page_obj.next_page_number }}" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
              <span class="visually-hidden">下一頁</span>
            </a>
          </li>
          {% else %}
          <li class="page-item disabled">
            <span class="page-link" aria-hidden="true">&raquo;</span>
            <span class="visually-hidden">下一頁</span>
          </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
</div>

<!-- 引入 Bootstrap Icons（可選，用於美化按鈕圖示） -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
{% endblock %}